!function(){function t(t,e,r,i,s){this.fromSampleRate=t,this.toSampleRate=e,this.channels=0|r,this.outputBufferSize=i,this.noReturn=!!s,this.initialize()}var e;e=this;var r;r={};var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};r.Base=function(){function t(){}var e;return e=/\b_super\b/,t.extend=function(t){var r,i,a,o,h,u;if(r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(this),"function"==typeof t){o=Object.keys(r.prototype),t.call(r,r),t={},h=r.prototype;for(a in h)i=h[a],n.call(o,a)<0&&(t[a]=i)}u=r.__super__;for(a in t)i=t[a],"function"==typeof i&&e.test(i)?!function(t,e){return r.prototype[t]=function(){var r,i;return i=this._super,this._super=u[t],r=e.apply(this,arguments),this._super=i,r}}(a,i):r.prototype[a]=i;return r},t}(),r.Buffer=function(){function t(t){var i;if(t instanceof Uint8Array)this.data=t;else if(t instanceof ArrayBuffer||Array.isArray(t)||"number"==typeof t||r.isNode&&(null!=(i=e.Buffer)?i.isBuffer(t):void 0))this.data=new Uint8Array(t);else if(t.buffer instanceof ArrayBuffer)this.data=new Uint8Array(t.buffer,t.byteOffset,t.length*t.BYTES_PER_ELEMENT);else{if(!(t instanceof r.Buffer))throw new Error("Constructing buffer with unknown type.");this.data=t.data}this.length=this.data.length,this.next=null,this.prev=null}var i,s;return t.allocate=function(t){return new r.Buffer(t)},t.prototype.copy=function(){return new r.Buffer(new Uint8Array(this.data))},t.prototype.slice=function(t,e){return null==e&&(e=this.length),new r.Buffer(0===t&&e>=this.length?this.data:this.data.subarray(t,t+e))},i=e.BlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,s=e.URL||e.webkitURL||e.mozURL,t.makeBlob=function(t,e){var r;null==e&&(e="application/octet-stream");try{return new Blob([t],{type:e})}catch(s){}return null!=i?(r=new i,r.append(t),r.getBlob(e)):null},t.makeBlobURL=function(t,e){return null!=s?s.createObjectURL(this.makeBlob(t,e)):void 0},t.revokeBlobURL=function(t){return null!=s?s.revokeObjectURL(t):void 0},t.prototype.toBlob=function(){return t.makeBlob(this.data.buffer)},t.prototype.toBlobURL=function(){return t.makeBlobURL(this.data.buffer)},t}(),r.BufferList=function(){function t(){this.first=null,this.last=null,this.numBuffers=0,this.availableBytes=0,this.availableBuffers=0}return t.prototype.copy=function(){var t;return t=new r.BufferList,t.first=this.first,t.last=this.last,t.numBuffers=this.numBuffers,t.availableBytes=this.availableBytes,t.availableBuffers=this.availableBuffers,t},t.prototype.append=function(t){var e;return t.prev=this.last,null!=(e=this.last)&&(e.next=t),this.last=t,null==this.first&&(this.first=t),this.availableBytes+=t.length,this.availableBuffers++,this.numBuffers++},t.prototype.advance=function(){return this.first?(this.availableBytes-=this.first.length,this.availableBuffers--,this.first=this.first.next,null!=this.first):!1},t.prototype.rewind=function(){var t;return this.first&&!this.first.prev?!1:(this.first=(null!=(t=this.first)?t.prev:void 0)||this.last,this.first&&(this.availableBytes+=this.first.length,this.availableBuffers++),null!=this.first)},t.prototype.reset=function(){var t;for(t=[];this.rewind(););return t},t}();var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Stream=function(){function t(t){this.list=t,this.localOffset=0,this.offset=0}var e,i,n,a,o,h,u,f,c,l,p,d,m;return e=new ArrayBuffer(16),m=new Uint8Array(e),c=new Int8Array(e),p=new Uint16Array(e),u=new Int16Array(e),d=new Uint32Array(e),f=new Int32Array(e),n=new Float32Array(e),"undefined"!=typeof Float64Array&&null!==Float64Array&&(a=new Float64Array(e)),l=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],r.UnderflowError=function(t){function e(){this.name="AV.UnderflowError"}return s(e,t),e}(Error),t.fromBuffer=function(t){var e;return e=new r.BufferList,e.append(t),new r.Stream(e)},t.prototype.copy=function(){var t;return t=new r.Stream(this.list.copy()),t.localOffset=this.localOffset,t.offset=this.offset,t},t.prototype.available=function(t){return t<=this.list.availableBytes-this.localOffset},t.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset},t.prototype.advance=function(t){if(!this.available(t))throw new r.UnderflowError;for(this.localOffset+=t,this.offset+=t;this.list.first&&this.localOffset>=this.list.first.length;)this.localOffset-=this.list.first.length,this.list.advance();return this},t.prototype.rewind=function(t){if(t>this.offset)throw new r.UnderflowError;for(this.list.first||(this.list.rewind(),this.localOffset=this.list.first.length),this.localOffset-=t,this.offset-=t;this.list.first.prev&&this.localOffset<0;)this.list.rewind(),this.localOffset+=this.list.first.length;return this},t.prototype.seek=function(t){return t>this.offset?this.advance(t-this.offset):t<this.offset?this.rewind(this.offset-t):void 0},t.prototype.readUInt8=function(){var t;if(!this.available(1))throw new r.UnderflowError;return t=this.list.first.data[this.localOffset],this.localOffset+=1,this.offset+=1,this.localOffset===this.list.first.length&&(this.localOffset=0,this.list.advance()),t},t.prototype.peekUInt8=function(t){var e;if(null==t&&(t=0),!this.available(t+1))throw new r.UnderflowError;for(t=this.localOffset+t,e=this.list.first;e;){if(e.length>t)return e.data[t];t-=e.length,e=e.next}return 0},t.prototype.read=function(t,e){var r,i,s,n;if(null==e&&(e=!1),e===l)for(r=i=0;t>i;r=i+=1)m[r]=this.readUInt8();else for(r=s=n=t-1;s>=0;r=s+=-1)m[r]=this.readUInt8()},t.prototype.peek=function(t,e,r){var i,s,n;if(null==r&&(r=!1),r===l)for(i=s=0;t>s;i=s+=1)m[i]=this.peekUInt8(e+i);else for(i=n=0;t>n;i=n+=1)m[t-i-1]=this.peekUInt8(e+i)},t.prototype.readInt8=function(){return this.read(1),c[0]},t.prototype.peekInt8=function(t){return null==t&&(t=0),this.peek(1,t),c[0]},t.prototype.readUInt16=function(t){return this.read(2,t),p[0]},t.prototype.peekUInt16=function(t,e){return null==t&&(t=0),this.peek(2,t,e),p[0]},t.prototype.readInt16=function(t){return this.read(2,t),u[0]},t.prototype.peekInt16=function(t,e){return null==t&&(t=0),this.peek(2,t,e),u[0]},t.prototype.readUInt24=function(t){return t?this.readUInt16(!0)+(this.readUInt8()<<16):(this.readUInt16()<<8)+this.readUInt8()},t.prototype.peekUInt24=function(t,e){return null==t&&(t=0),e?this.peekUInt16(t,!0)+(this.peekUInt8(t+2)<<16):(this.peekUInt16(t)<<8)+this.peekUInt8(t+2)},t.prototype.readInt24=function(t){return t?this.readUInt16(!0)+(this.readInt8()<<16):(this.readInt16()<<8)+this.readUInt8()},t.prototype.peekInt24=function(t,e){return null==t&&(t=0),e?this.peekUInt16(t,!0)+(this.peekInt8(t+2)<<16):(this.peekInt16(t)<<8)+this.peekUInt8(t+2)},t.prototype.readUInt32=function(t){return this.read(4,t),d[0]},t.prototype.peekUInt32=function(t,e){return null==t&&(t=0),this.peek(4,t,e),d[0]},t.prototype.readInt32=function(t){return this.read(4,t),f[0]},t.prototype.peekInt32=function(t,e){return null==t&&(t=0),this.peek(4,t,e),f[0]},t.prototype.readFloat32=function(t){return this.read(4,t),n[0]},t.prototype.peekFloat32=function(t,e){return null==t&&(t=0),this.peek(4,t,e),n[0]},t.prototype.readFloat64=function(t){return this.read(8,t),a?a[0]:o()},o=function(){var t,e,r,i,s,n;return i=d[0],r=d[1],r&&2147483648!==r?(n=1-2*(r>>>31),t=r>>>20&2047,e=1048575&r,2047===t?e?0/0:1/0*n:(t-=1023,s=(1048576|e)*Math.pow(2,t-20),s+=i*Math.pow(2,t-52),n*s)):0},t.prototype.peekFloat64=function(t,e){return null==t&&(t=0),this.peek(8,t,e),a?a[0]:o()},t.prototype.readFloat80=function(t){return this.read(10,t),h()},h=function(){var t,e,r,i,s,n,a;return i=d[0],s=d[1],t=m[9],e=m[8],a=1-2*(t>>>7),r=(127&t)<<8|e,0===r&&0===s&&0===i?0:32767===r?0===s&&0===i?1/0*a:0/0:(r-=16383,n=s*Math.pow(2,r-31),n+=i*Math.pow(2,r-63),a*n)},t.prototype.peekFloat80=function(t,e){return null==t&&(t=0),this.peek(10,t,e),h()},t.prototype.readBuffer=function(t){var e,i,s,n;for(i=r.Buffer.allocate(t),s=i.data,e=n=0;t>n;e=n+=1)s[e]=this.readUInt8();return i},t.prototype.peekBuffer=function(t,e){var i,s,n,a;for(null==t&&(t=0),s=r.Buffer.allocate(e),n=s.data,i=a=0;e>a;i=a+=1)n[i]=this.peekUInt8(t+i);return s},t.prototype.readSingleBuffer=function(t){var e;return e=this.list.first.slice(this.localOffset,t),this.advance(e.length),e},t.prototype.peekSingleBuffer=function(t,e){var r;return r=this.list.first.slice(this.localOffset+t,e)},t.prototype.readString=function(t,e){return null==e&&(e="ascii"),i.call(this,0,t,e,!0)},t.prototype.peekString=function(t,e,r){return null==t&&(t=0),null==r&&(r="ascii"),i.call(this,t,e,r,!1)},i=function(t,e,r,i){var s,n,a,o,h,u,f,c,l,p,d,m,v;switch(r=r.toLowerCase(),l=null===e?0:-1,null==e&&(e=1/0),f=t+e,d="",r){case"ascii":case"latin1":for(;f>t&&(u=this.peekUInt8(t++))!==l;)d+=String.fromCharCode(u);break;case"utf8":case"utf-8":for(;f>t&&(s=this.peekUInt8(t++))!==l;)0===(128&s)?d+=String.fromCharCode(s):192===(224&s)?(n=63&this.peekUInt8(t++),d+=String.fromCharCode((31&s)<<6|n)):224===(240&s)?(n=63&this.peekUInt8(t++),a=63&this.peekUInt8(t++),d+=String.fromCharCode((15&s)<<12|n<<6|a)):240===(248&s)&&(n=63&this.peekUInt8(t++),a=63&this.peekUInt8(t++),o=63&this.peekUInt8(t++),p=((15&s)<<18|n<<12|a<<6|o)-65536,d+=String.fromCharCode(55296+(p>>10),56320+(1023&p)));break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(r){case"utf16be":case"utf16-be":c=!1;break;case"utf16le":case"utf16-le":c=!0;break;case"utf16bom":case"utf16-bom":if(2>e||(h=this.peekUInt16(t))===l)return i&&this.advance(t+=2),d;c=65534===h,t+=2}for(;f>t&&(m=this.peekUInt16(t,c))!==l;)if(t+=2,55296>m||m>57343)d+=String.fromCharCode(m);else{if(m>56319)throw new Error("Invalid utf16 sequence.");if(v=this.peekUInt16(t,c),56320>v||v>57343)throw new Error("Invalid utf16 sequence.");d+=String.fromCharCode(m,v),t+=2}m===l&&(t+=2);break;default:throw new Error("Unknown encoding: "+r)}return i&&this.advance(t),d},t}(),r.Bitstream=function(){function t(t){this.stream=t,this.bitPosition=0}return t.prototype.copy=function(){var t;return t=new r.Bitstream(this.stream.copy()),t.bitPosition=this.bitPosition,t},t.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition},t.prototype.available=function(t){return this.stream.available((t+8-this.bitPosition)/8)},t.prototype.advance=function(t){var e;return e=this.bitPosition+t,this.stream.advance(e>>3),this.bitPosition=7&e},t.prototype.rewind=function(t){var e;return e=this.bitPosition-t,this.stream.rewind(Math.abs(e>>3)),this.bitPosition=7&e},t.prototype.seek=function(t){var e;return e=this.offset(),t>e?this.advance(t-e):e>t?this.rewind(e-t):void 0},t.prototype.align=function(){return 0!==this.bitPosition?(this.bitPosition=0,this.stream.advance(1)):void 0},t.prototype.read=function(t,e){var r,i,s,n,a,o,h;if(0===t)return 0;if(h=t+this.bitPosition,8>=h)r=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-t;else if(16>=h)r=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-t;else if(24>=h)r=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-t;else if(32>=h)r=this.stream.peekUInt32()<<this.bitPosition>>>32-t;else{if(!(40>=h))throw new Error("Too many bits!");i=4294967296*this.stream.peekUInt8(0),s=this.stream.peekUInt8(1)<<24>>>0,n=this.stream.peekUInt8(2)<<16,a=this.stream.peekUInt8(3)<<8,o=this.stream.peekUInt8(4),r=i+s+n+a+o,r%=Math.pow(2,40-this.bitPosition),r=Math.floor(r/Math.pow(2,40-this.bitPosition-t))}return e&&(32>h?r>>>t-1&&(r=-1*((1<<t>>>0)-r)):r/Math.pow(2,t-1)|0&&(r=-1*(Math.pow(2,t)-r))),this.advance(t),r},t.prototype.peek=function(t,e){var r,i,s,n,a,o,h;if(0===t)return 0;if(h=t+this.bitPosition,8>=h)r=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-t;else if(16>=h)r=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-t;else if(24>=h)r=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-t;else if(32>=h)r=this.stream.peekUInt32()<<this.bitPosition>>>32-t;else{if(!(40>=h))throw new Error("Too many bits!");i=4294967296*this.stream.peekUInt8(0),s=this.stream.peekUInt8(1)<<24>>>0,n=this.stream.peekUInt8(2)<<16,a=this.stream.peekUInt8(3)<<8,o=this.stream.peekUInt8(4),r=i+s+n+a+o,r%=Math.pow(2,40-this.bitPosition),r=Math.floor(r/Math.pow(2,40-this.bitPosition-t))}return e&&(32>h?r>>>t-1&&(r=-1*((1<<t>>>0)-r)):r/Math.pow(2,t-1)|0&&(r=-1*(Math.pow(2,t)-r))),r},t.prototype.readLSB=function(t,e){var r,i;if(0===t)return 0;if(t>40)throw new Error("Too many bits!");return i=t+this.bitPosition,r=this.stream.peekUInt8(0)>>>this.bitPosition,i>8&&(r|=this.stream.peekUInt8(1)<<8-this.bitPosition),i>16&&(r|=this.stream.peekUInt8(2)<<16-this.bitPosition),i>24&&(r+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),i>32&&(r+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),i>=32?r%=Math.pow(2,t):r&=(1<<t)-1,e&&(32>i?r>>>t-1&&(r=-1*((1<<t>>>0)-r)):r/Math.pow(2,t-1)|0&&(r=-1*(Math.pow(2,t)-r))),this.advance(t),r},t.prototype.peekLSB=function(t,e){var r,i;if(0===t)return 0;if(t>40)throw new Error("Too many bits!");return i=t+this.bitPosition,r=this.stream.peekUInt8(0)>>>this.bitPosition,i>8&&(r|=this.stream.peekUInt8(1)<<8-this.bitPosition),i>16&&(r|=this.stream.peekUInt8(2)<<16-this.bitPosition),i>24&&(r+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),i>32&&(r+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),i>=32?r%=Math.pow(2,t):r&=(1<<t)-1,e&&(32>i?r>>>t-1&&(r=-1*((1<<t>>>0)-r)):r/Math.pow(2,t-1)|0&&(r=-1*(Math.pow(2,t)-r))),r},t}();var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a=[].slice;r.EventEmitter=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.on=function(t,e){var r;return null==this.events&&(this.events={}),null==(r=this.events)[t]&&(r[t]=[]),this.events[t].push(e)},e.prototype.off=function(t,e){var r,i;if(null!=(i=this.events)?i[t]:void 0)return r=this.events[t].indexOf(e),~r?this.events[t].splice(r,1):void 0},e.prototype.once=function(t,e){var r;return this.on(t,r=function(){return this.off(t,r),e.apply(this,arguments)})},e.prototype.emit=function(){var t,e,r,i,s,n,o;if(e=arguments[0],t=2<=arguments.length?a.call(arguments,1):[],null!=(n=this.events)?n[e]:void 0)for(o=this.events[e].slice(),i=0,s=o.length;s>i;i++)r=o[i],r.apply(this,t)},e}(r.Base);var o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.BufferSource=function(t){function i(t){this.loop=o(this.loop,this),t instanceof r.BufferList?this.list=t:(this.list=new r.BufferList,this.list.append(new r.Buffer(t))),this.paused=!0}var n,a;return s(i,t),a=e.setImmediate||function(t){return e.setTimeout(t,0)},n=e.clearImmediate||function(t){return e.clearTimeout(t)},i.prototype.start=function(){return this.paused=!1,this._timer=a(this.loop)},i.prototype.loop=function(){return this.emit("progress",(this.list.numBuffers-this.list.availableBuffers+1)/this.list.numBuffers*100|0),this.emit("data",this.list.first),this.list.advance()?a(this.loop):this.emit("end")},i.prototype.pause=function(){return n(this._timer),this.paused=!0},i.prototype.reset=function(){return this.pause(),this.list.rewind()},i}(r.EventEmitter);var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Demuxer=function(t){function e(t,e){var i,s;i=new r.BufferList,i.append(e),this.stream=new r.Stream(i),s=!1,t.on("data",function(t){return function(e){return s=!0,i.append(e),t.readChunk(e)}}(this)),t.on("error",function(t){return function(e){return t.emit("error",e)}}(this)),t.on("end",function(t){return function(){return s||t.readChunk(e),t.emit("end")}}(this)),this.seekPoints=[],this.init()}var i;return s(e,t),e.probe=function(){return!1},e.prototype.init=function(){},e.prototype.readChunk=function(){},e.prototype.addSeekPoint=function(t,e){var r;return r=this.searchTimestamp(e),this.seekPoints.splice(r,0,{offset:t,timestamp:e})},e.prototype.searchTimestamp=function(t){var e,r,i,s;if(r=0,e=this.seekPoints.length,e>0&&this.seekPoints[e-1].timestamp<t)return e;for(;e>r;)i=r+e>>1,s=this.seekPoints[i].timestamp,t>s?r=i+1:s>=t&&(e=i);return e>this.seekPoints.length&&(e=this.seekPoints.length),e},e.prototype.seek=function(t){var e,r;return this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0?r={timestamp:t,offset:this.format.bytesPerPacket*t/this.format.framesPerPacket}:(e=this.searchTimestamp(t),this.seekPoints[e])},i=[],e.register=function(t){return i.push(t)},e.find=function(t){var e,s,n,a;for(s=r.Stream.fromBuffer(t),n=0,a=i.length;a>n;n++)if(e=i[n],e.probe(s))return e;return null},e}(r.EventEmitter);var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Decoder=function(t){function e(t,e){var i;this.demuxer=t,this.format=e,i=new r.BufferList,this.stream=new r.Stream(i),this.bitstream=new r.Bitstream(this.stream),this.receivedFinalBuffer=!1,this.waiting=!1,this.demuxer.on("cookie",function(t){return function(e){var r;try{return t.setCookie(e)}catch(i){return r=i,t.emit("error",r)}}}(this)),this.demuxer.on("data",function(t){return function(e){return i.append(e),t.waiting?t.decode():void 0}}(this)),this.demuxer.on("end",function(t){return function(){return t.receivedFinalBuffer=!0,t.waiting?t.decode():void 0}}(this)),this.init()}var i;return s(e,t),e.prototype.init=function(){},e.prototype.setCookie=function(){},e.prototype.readChunk=function(){},e.prototype.decode=function(){var t,e,i;this.waiting=!1,e=this.bitstream.offset();try{i=this.readChunk()}catch(s){if(t=s,!(t instanceof r.UnderflowError))return this.emit("error",t),!1}return i?(this.emit("data",i),!0):(this.receivedFinalBuffer?this.emit("end"):(this.bitstream.seek(e),this.waiting=!0),!1)},e.prototype.seek=function(t){var e;return e=this.demuxer.seek(t),this.stream.seek(e.offset),e.timestamp},i={},e.register=function(t,e){return i[t]=e},e.find=function(t){return i[t]||null},e}(r.EventEmitter);var o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Queue=function(t){function e(t){this.asset=t,this.write=o(this.write,this),this.readyMark=64,this.finished=!1,this.buffering=!0,this.ended=!1,this.buffers=[],this.asset.on("data",this.write),this.asset.on("end",function(t){return function(){return t.ended=!0}}(this)),this.asset.decodePacket()}return s(e,t),e.prototype.write=function(t){return t&&this.buffers.push(t),this.buffering?this.buffers.length>=this.readyMark||this.ended?(this.buffering=!1,this.emit("ready")):this.asset.decodePacket():void 0},e.prototype.read=function(){return 0===this.buffers.length?null:(this.asset.decodePacket(),this.buffers.shift())},e.prototype.reset=function(){return this.buffers.length=0,this.buffering=!0,this.asset.decodePacket()},e}(r.EventEmitter);var o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.AudioDevice=function(t){function e(t,e){this.sampleRate=t,this.channels=e,this.updateTime=o(this.updateTime,this),this.playing=!1,this.currentTime=0,this._lastTime=0}var i;return s(e,t),e.prototype.start=function(){if(!this.playing){if(this.playing=!0,null==this.device&&(this.device=r.AudioDevice.create(this.sampleRate,this.channels)),!this.device)throw new Error("No supported audio device found.");return this._lastTime=this.device.getDeviceTime(),this._timer=setInterval(this.updateTime,200),this.device.on("refill",this.refill=function(t){return function(e){return t.emit("refill",e)}}(this))}},e.prototype.stop=function(){return this.playing?(this.playing=!1,this.device.off("refill",this.refill),clearInterval(this._timer)):void 0},e.prototype.destroy=function(){return this.stop(),this.device.destroy()},e.prototype.seek=function(t){return this.currentTime=t,this.playing&&(this._lastTime=this.device.getDeviceTime()),this.emit("timeUpdate",this.currentTime)},e.prototype.updateTime=function(){var t;return t=this.device.getDeviceTime(),this.currentTime+=(t-this._lastTime)/this.device.sampleRate*1e3|0,this._lastTime=t,this.emit("timeUpdate",this.currentTime)},i=[],e.register=function(t){return i.push(t)},e.create=function(t,e){var r,s,n;for(s=0,n=i.length;n>s;s++)if(r=i[s],r.supported)return new r(t,e);return null},e}(r.EventEmitter);var o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Asset=function(t){function e(t){this.source=t,this._decode=o(this._decode,this),this.findDecoder=o(this.findDecoder,this),this.probe=o(this.probe,this),this.buffered=0,this.duration=null,this.format=null,this.metadata=null,this.active=!1,this.demuxer=null,this.decoder=null,this.source.once("data",this.probe),this.source.on("error",function(t){return function(e){return t.emit("error",e),t.stop()}}(this)),this.source.on("progress",function(t){return function(e){return t.buffered=e,t.emit("buffer",t.buffered)}}(this))}return s(e,t),e.fromURL=function(t){return new r.Asset(new r.HTTPSource(t))},e.fromFile=function(t){return new r.Asset(new r.FileSource(t))},e.fromBuffer=function(t){return new r.Asset(new r.BufferSource(t))},e.prototype.start=function(t){return this.active?void 0:(null!=t&&(this.shouldDecode=t),null==this.shouldDecode&&(this.shouldDecode=!0),this.active=!0,this.source.start(),this.decoder&&this.shouldDecode?this._decode():void 0)},e.prototype.stop=function(){return this.active?(this.active=!1,this.source.pause()):void 0},e.prototype.get=function(t,e){return"format"===t||"duration"===t||"metadata"===t?null!=this[t]?e(this[t]):(this.once(t,function(t){return function(r){return t.stop(),e(r)}}(this)),this.start()):void 0},e.prototype.decodePacket=function(){return this.decoder.decode()},e.prototype.decodeToBuffer=function(t){var e,r,i;return i=0,e=[],this.on("data",r=function(t){return i+=t.length,e.push(t)}),this.once("end",function(){var s,n,a,o,h;for(s=new Float32Array(i),a=0,o=0,h=e.length;h>o;o++)n=e[o],s.set(n,a),a+=n.length;return this.off("data",r),t(s)}),this.start()},e.prototype.probe=function(t){var e;if(this.active)return(e=r.Demuxer.find(t))?(this.demuxer=new e(this.source,t),this.demuxer.on("format",this.findDecoder),this.demuxer.on("duration",function(t){return function(e){return t.duration=e,t.emit("duration",t.duration)}}(this)),this.demuxer.on("metadata",function(t){return function(e){return t.metadata=e,t.emit("metadata",t.metadata)}}(this)),this.demuxer.on("error",function(t){return function(e){return t.emit("error",e),t.stop()}}(this))):this.emit("error","A demuxer for this container was not found.")},e.prototype.findDecoder=function(t){var e,i;return this.format=t,this.active?(this.emit("format",this.format),(e=r.Decoder.find(this.format.formatID))?(this.decoder=new e(this.demuxer,this.format),this.format.floatingPoint?this.decoder.on("data",function(t){return function(e){return t.emit("data",e)}}(this)):(i=Math.pow(2,this.format.bitsPerChannel-1),this.decoder.on("data",function(t){return function(e){var r,s,n,a,o;for(r=new Float32Array(e.length),s=a=0,o=e.length;o>a;s=++a)n=e[s],r[s]=n/i;return t.emit("data",r)}}(this))),this.decoder.on("error",function(t){return function(e){return t.emit("error",e),t.stop()}}(this)),this.decoder.on("end",function(t){return function(){return t.emit("end")}}(this)),this.emit("decodeStart"),this.shouldDecode?this._decode():void 0):this.emit("error","A decoder for "+this.format.formatID+" was not found.")):void 0},e.prototype._decode=function(){for(;this.decoder.decode()&&this.active;);return this.active?this.decoder.once("data",this._decode):void 0},e}(r.EventEmitter);var o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.Player=function(t){function e(t){this.asset=t,this.startPlaying=o(this.startPlaying,this),this.playing=!1,this.buffered=0,this.currentTime=0,this.duration=0,this.volume=100,this.pan=0,this.metadata={},this.filters=[new r.VolumeFilter(this,"volume"),new r.BalanceFilter(this,"pan")],this.asset.on("buffer",function(t){return function(e){return t.buffered=e,t.emit("buffer",t.buffered)}}(this)),this.asset.on("decodeStart",function(t){return function(){return t.queue=new r.Queue(t.asset),t.queue.once("ready",t.startPlaying)}}(this)),this.asset.on("format",function(t){return function(e){return t.format=e,t.emit("format",t.format)}}(this)),this.asset.on("metadata",function(t){return function(e){return t.metadata=e,t.emit("metadata",t.metadata)}}(this)),this.asset.on("duration",function(t){return function(e){return t.duration=e,t.emit("duration",t.duration)}}(this)),this.asset.on("error",function(t){return function(e){return t.emit("error",e)}}(this))}return s(e,t),e.fromURL=function(t){return new r.Player(r.Asset.fromURL(t))},e.fromFile=function(t){return new r.Player(r.Asset.fromFile(t))},e.fromBuffer=function(t){return new r.Player(r.Asset.fromBuffer(t))},e.prototype.preload=function(){return this.asset?(this.startedPreloading=!0,this.asset.start(!1)):void 0},e.prototype.play=function(){var t;if(!this.playing)return this.startedPreloading||this.preload(),this.playing=!0,null!=(t=this.device)?t.start():void 0},e.prototype.pause=function(){var t;if(this.playing)return this.playing=!1,null!=(t=this.device)?t.stop():void 0},e.prototype.togglePlayback=function(){return this.playing?this.pause():this.play()},e.prototype.stop=function(){var t;return this.pause(),this.asset.stop(),null!=(t=this.device)?t.destroy():void 0},e.prototype.seek=function(t){var e;return null!=(e=this.device)&&e.stop(),this.queue.once("ready",function(t){return function(){var e,r;return null!=(e=t.device)&&e.seek(t.currentTime),t.playing&&null!=(r=t.device)?r.start():void 0}}(this)),t=t/1e3*this.format.sampleRate,t=this.asset.decoder.seek(t),this.currentTime=t/this.format.sampleRate*1e3|0,this.queue.reset(),this.currentTime},e.prototype.startPlaying=function(){var t,e;return t=this.queue.read(),e=0,this.device=new r.AudioDevice(this.format.sampleRate,this.format.channelsPerFrame),this.device.on("timeUpdate",function(t){return function(e){return t.currentTime=e,t.emit("progress",t.currentTime)}}(this)),this.refill=function(r){return function(i){var s,n,a,o,h,u,f,c;if(r.playing){for(t||(t=r.queue.read(),e=0),s=0;t&&s<i.length;){for(o=Math.min(t.length-e,i.length-s),a=h=0;o>h;a=h+=1)i[s++]=t[e++];e===t.length&&(t=r.queue.read(),e=0)}for(c=r.filters,u=0,f=c.length;f>u;u++)n=c[u],n.process(i);t||(r.queue.ended?(r.currentTime=r.duration,r.emit("progress",r.currentTime),r.emit("end"),r.stop()):r.device.stop())}}}(this),this.device.on("refill",this.refill),this.playing&&this.device.start(),this.emit("ready")},e}(r.EventEmitter),r.Filter=function(){function t(t,e){t&&e&&Object.defineProperty(this,"value",{get:function(){return t[e]}})}return t.prototype.process=function(){},t}();var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.VolumeFilter=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.process=function(t){var e,r,i,s;if(!(this.value>=100))for(r=Math.max(0,Math.min(100,this.value))/100,e=i=0,s=t.length;s>i;e=i+=1)t[e]*=r},e}(r.Filter);var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.BalanceFilter=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.process=function(t){var e,r,i,s;if(0!==this.value)for(r=Math.max(-50,Math.min(50,this.value)),e=i=0,s=t.length;s>i;e=i+=2)t[e]*=Math.min(1,(50-r)/50),t[e+1]*=Math.min(1,(50+r)/50)},e}(r.Filter);var h,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),r.Demuxer.register(e),e.probe=function(t){return"caff"===t.peekString(0,4)},e.prototype.readChunk=function(){var t,e,r,i,s,n,a,o,h,f,c,l,p,d;if(!this.format&&this.stream.available(64)){if("caff"!==this.stream.readString(4))return this.emit("error","Invalid CAF, does not begin with 'caff'");if(this.stream.advance(4),"desc"!==this.stream.readString(4))return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'");if(0!==this.stream.readUInt32()||32!==this.stream.readUInt32())return this.emit("error","Invalid 'desc' size, should be 32");this.format={},this.format.sampleRate=this.stream.readFloat64(),this.format.formatID=this.stream.readString(4),s=this.stream.readUInt32(),"lpcm"===this.format.formatID&&(this.format.floatingPoint=Boolean(1&s),this.format.littleEndian=Boolean(2&s)),this.format.bytesPerPacket=this.stream.readUInt32(),this.format.framesPerPacket=this.stream.readUInt32(),this.format.channelsPerFrame=this.stream.readUInt32(),this.format.bitsPerChannel=this.stream.readUInt32(),this.emit("format",this.format)}for(;this.stream.available(1);){if(!this.headerCache&&(this.headerCache={type:this.stream.readString(4),oversize:0!==this.stream.readUInt32(),size:this.stream.readUInt32()},this.headerCache.oversize))return this.emit("error","Holy Shit, an oversized file, not supported in JS");switch(this.headerCache.type){case"kuki":this.stream.available(this.headerCache.size)&&("aac "===this.format.formatID?(h=this.stream.offset+this.headerCache.size,(r=u.readEsds(this.stream))&&this.emit("cookie",r),this.stream.seek(h)):(t=this.stream.readBuffer(this.headerCache.size),this.emit("cookie",t)),this.headerCache=null);break;case"pakt":if(this.stream.available(this.headerCache.size)){if(0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");if(this.numPackets=this.stream.readUInt32(),0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");for(this.numFrames=this.stream.readUInt32(),this.primingFrames=this.stream.readUInt32(),this.remainderFrames=this.stream.readUInt32(),this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0),this.sentDuration=!0,e=0,f=0,n=l=0,d=this.numPackets;d>l;n=l+=1)this.addSeekPoint(e,f),e+=this.format.bytesPerPacket||u.readDescrLen(this.stream),f+=this.format.framesPerPacket||u.readDescrLen(this.stream);this.headerCache=null}break;case"info":for(i=this.stream.readUInt32(),o={},n=p=0;i>=0?i>p:p>i;n=i>=0?++p:--p)a=this.stream.readString(null),c=this.stream.readString(null),o[a]=c;this.emit("metadata",o),this.headerCache=null;break;case"data":this.sentFirstDataChunk||(this.stream.advance(4),this.headerCache.size-=4,0===this.format.bytesPerPacket||this.sentDuration||(this.numFrames=this.headerCache.size/this.format.bytesPerPacket,this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0)),this.sentFirstDataChunk=!0),t=this.stream.readSingleBuffer(this.headerCache.size),this.headerCache.size-=t.length,this.emit("data",t),this.headerCache.size<=0&&(this.headerCache=null);
break;default:this.stream.available(this.headerCache.size)&&(this.stream.advance(this.headerCache.size),this.headerCache=null)}}},e}(r.Demuxer);var u,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var i,a,o,h,u,f,c,l,p,d,m;return s(e,t),r.Demuxer.register(e),a=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "],e.probe=function(t){var e;return"ftyp"===t.peekString(4,4)&&(e=t.peekString(8,4),n.call(a,e)>=0)},e.prototype.init=function(){return this.atoms=[],this.offsets=[],this.track=null,this.tracks=[]},u={},c={},h=function(t,e){var r,i,s,n,a;for(r=[],a=t.split(".").slice(0,-1),s=0,n=a.length;n>s;s++)i=a[s],r.push(i),c[r.join(".")]=!0;return null==u[t]&&(u[t]={}),u[t].fn=e},o=function(t,e){return null==u[t]&&(u[t]={}),u[t].after=e},e.prototype.readChunk=function(){var t,e,r;for(this["break"]=!1;this.stream.available(1)&&!this["break"];){if(!this.readHeaders){if(!this.stream.available(8))return;if(this.len=this.stream.readUInt32()-8,this.type=this.stream.readString(4),0===this.len)continue;this.atoms.push(this.type),this.offsets.push(this.stream.offset+this.len),this.readHeaders=!0}if(e=this.atoms.join("."),t=u[e],null!=t?t.fn:void 0){if(!this.stream.available(this.len)&&"mdat"!==e)return;t.fn.call(this),e in c&&(this.readHeaders=!1)}else if(e in c)this.readHeaders=!1;else{if(!this.stream.available(this.len))return;this.stream.advance(this.len)}for(;this.stream.offset>=this.offsets[this.offsets.length-1];)t=u[this.atoms.join(".")],(null!=t?t.after:void 0)&&t.after.call(this),r=this.atoms.pop(),this.offsets.pop(),this.readHeaders=!1}},h("ftyp",function(){var t;return t=this.stream.readString(4),n.call(a,t)<0?this.emit("error","Not a valid M4A file."):this.stream.advance(this.len-4)}),h("moov.trak",function(){return this.track={},this.tracks.push(this.track)}),h("moov.trak.tkhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.id=this.stream.readUInt32(),this.stream.advance(this.len-16)}),h("moov.trak.mdia.hdlr",function(){return this.stream.advance(4),this.stream.advance(4),this.track.type=this.stream.readString(4),this.stream.advance(12),this.stream.advance(this.len-24)}),h("moov.trak.mdia.mdhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.timeScale=this.stream.readUInt32(),this.track.duration=this.stream.readUInt32(),this.stream.advance(4)}),i={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64},h("moov.trak.mdia.minf.stbl.stsd",function(){var t,e,r,s,n;return this.stream.advance(4),e=this.stream.readUInt32(),"soun"!==this.track.type?this.stream.advance(this.len-8):1!==e?this.emit("error","Only expecting one entry in sample description atom!"):(this.stream.advance(4),t=this.track.format={},t.formatID=this.stream.readString(4),this.stream.advance(6),this.stream.advance(2),r=this.stream.readUInt16(),this.stream.advance(6),t.channelsPerFrame=this.stream.readUInt16(),t.bitsPerChannel=this.stream.readUInt16(),this.stream.advance(4),t.sampleRate=this.stream.readUInt16(),this.stream.advance(2),1===r?(t.framesPerPacket=this.stream.readUInt32(),this.stream.advance(4),t.bytesPerFrame=this.stream.readUInt32(),this.stream.advance(4)):0!==r&&this.emit("error","Unknown version in stsd atom"),null!=i[t.formatID]&&(t.bitsPerChannel=i[t.formatID]),t.floatingPoint="fl32"===(s=t.formatID)||"fl64"===s,t.littleEndian="sowt"===t.formatID&&t.bitsPerChannel>8,"twos"===(n=t.formatID)||"sowt"===n||"in24"===n||"in32"===n||"fl32"===n||"fl64"===n||"raw "===n||"NONE"===n?t.formatID="lpcm":void 0)}),h("moov.trak.mdia.minf.stbl.stsd.alac",function(){return this.stream.advance(4),this.track.cookie=this.stream.readBuffer(this.len-4)}),h("moov.trak.mdia.minf.stbl.stsd.esds",function(){var t;return t=this.stream.offset+this.len,this.track.cookie=e.readEsds(this.stream),this.stream.seek(t)}),h("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()}),e.readDescrLen=function(t){var e,r,i;for(i=0,r=4;r--&&(e=t.readUInt8(),i=i<<7|127&e,128&e););return i},e.readEsds=function(t){var r,i,s,n;return t.advance(4),n=t.readUInt8(),s=e.readDescrLen(t),3===n?(t.advance(2),i=t.readUInt8(),128&i&&t.advance(2),64&i&&t.advance(t.readUInt8()),32&i&&t.advance(2)):t.advance(2),n=t.readUInt8(),s=e.readDescrLen(t),4===n&&(r=t.readUInt8(),t.advance(1),t.advance(3),t.advance(4),t.advance(4),n=t.readUInt8(),s=e.readDescrLen(t),5===n)?t.readBuffer(s):null},h("moov.trak.mdia.minf.stbl.stts",function(){var t,e,r;for(this.stream.advance(4),t=this.stream.readUInt32(),this.track.stts=[],e=r=0;t>r;e=r+=1)this.track.stts[e]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()};return this.setupSeekPoints()}),h("moov.trak.mdia.minf.stbl.stsc",function(){var t,e,r;for(this.stream.advance(4),t=this.stream.readUInt32(),this.track.stsc=[],e=r=0;t>r;e=r+=1)this.track.stsc[e]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()};return this.setupSeekPoints()}),h("moov.trak.mdia.minf.stbl.stsz",function(){var t,e,r;if(this.stream.advance(4),this.track.sampleSize=this.stream.readUInt32(),t=this.stream.readUInt32(),0===this.track.sampleSize&&t>0)for(this.track.sampleSizes=[],e=r=0;t>r;e=r+=1)this.track.sampleSizes[e]=this.stream.readUInt32();return this.setupSeekPoints()}),h("moov.trak.mdia.minf.stbl.stco",function(){var t,e,r;for(this.stream.advance(4),t=this.stream.readUInt32(),this.track.chunkOffsets=[],e=r=0;t>r;e=r+=1)this.track.chunkOffsets[e]=this.stream.readUInt32();return this.setupSeekPoints()}),h("moov.trak.tref.chap",function(){var t,e,r;for(t=this.len>>2,this.track.chapterTracks=[],e=r=0;t>r;e=r+=1)this.track.chapterTracks[e]=this.stream.readUInt32()}),e.prototype.setupSeekPoints=function(){var t,e,r,i,s,n,a,o,h,u,f,c,l,p,d,m;if(null!=this.track.chunkOffsets&&null!=this.track.stsc&&null!=this.track.sampleSize&&null!=this.track.stts){for(a=0,o=0,o=0,h=0,s=0,r=0,u=0,this.track.seekPoints=[],p=this.track.chunkOffsets,m=[],t=f=0,l=p.length;l>f;t=++f){for(i=p[t],e=c=0,d=this.track.stsc[a].count;d>c;e=c+=1)this.track.seekPoints.push({offset:r,position:i,timestamp:u}),n=this.track.sampleSize||this.track.sampleSizes[s++],r+=n,i+=n,u+=this.track.stts[o].duration,o+1<this.track.stts.length&&++h===this.track.stts[o].count&&(h=0,o++);m.push(a+1<this.track.stsc.length&&t+1===this.track.stsc[a+1].first?a++:void 0)}return m}},o("moov",function(){var t,e,r,i;for(null!=this.mdatOffset&&this.stream.seek(this.mdatOffset-8),i=this.tracks,e=0,r=i.length;r>e;e++)if(t=i[e],"soun"===t.type){this.track=t;break}return"soun"!==this.track.type?(this.track=null,this.emit("error","No audio tracks in m4a file.")):(this.emit("format",this.track.format),this.emit("duration",this.track.duration/this.track.timeScale*1e3|0),this.track.cookie&&this.emit("cookie",this.track.cookie),this.seekPoints=this.track.seekPoints)}),h("mdat",function(){var t,e,r,i,s,n,a,o;if(!this.startedData){if(null==this.mdatOffset&&(this.mdatOffset=this.stream.offset),0===this.tracks.length)return t=Math.min(this.stream.remainingBytes(),this.len),this.stream.advance(t),void(this.len-=t);this.chunkIndex=0,this.stscIndex=0,this.sampleIndex=0,this.tailOffset=0,this.tailSamples=0,this.startedData=!0}if(!this.readChapters){if(this.readChapters=this.parseChapters(),this["break"]=!this.readChapters)return;this.stream.seek(this.mdatOffset)}if(s=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset,r=0,!this.stream.available(s-this.stream.offset))return void(this["break"]=!0);for(this.stream.seek(s);this.chunkIndex<this.track.chunkOffsets.length;){for(i=this.track.stsc[this.stscIndex].count-this.tailSamples,e=0,n=o=0;i>o&&(a=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex],this.stream.available(r+a));n=o+=1)r+=a,e+=a,this.sampleIndex++;if(i>n){this.tailOffset+=e,this.tailSamples+=n;break}if(this.chunkIndex++,this.tailOffset=0,this.tailSamples=0,this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first&&this.stscIndex++,s+r!==this.track.chunkOffsets[this.chunkIndex])break}return r>0?(this.emit("data",this.stream.readBuffer(r)),this["break"]=this.chunkIndex===this.track.chunkOffsets.length):this["break"]=!0}),e.prototype.parseChapters=function(){var t,e,r,i,s,n,a,o,h,u,f,c,l;if(!((null!=(u=this.track.chapterTracks)?u.length:void 0)>0))return!0;for(e=this.track.chapterTracks[0],f=this.tracks,o=0,h=f.length;h>o&&(a=f[o],a.id!==e);o++);for(a.id!==e&&this.emit("error","Chapter track does not exist."),null==this.chapters&&(this.chapters=[]);this.chapters.length<a.seekPoints.length;){if(s=a.seekPoints[this.chapters.length],!this.stream.available(s.position-this.stream.offset+32))return!1;if(this.stream.seek(s.position),r=this.stream.readUInt16(),n=null,!this.stream.available(r))return!1;r>2&&(t=this.stream.peekUInt16(),(65279===t||65534===t)&&(n=this.stream.readString(r,"utf16-bom"))),null==n&&(n=this.stream.readString(r,"utf8")),i=null!=(c=null!=(l=a.seekPoints[this.chapters.length+1])?l.timestamp:void 0)?c:a.duration,this.chapters.push({title:n,timestamp:s.timestamp/a.timeScale*1e3|0,duration:(i-s.timestamp)/a.timeScale*1e3|0})}return this.emit("chapters",this.chapters),!0},h("moov.udta.meta",function(){return this.metadata={},this.stream.advance(4)}),o("moov.udta.meta",function(){return this.emit("metadata",this.metadata)}),d=function(t,e,r){return h("moov.udta.meta.ilst."+t+".data",function(){return this.stream.advance(8),this.len-=8,r.call(this,e)})},m=function(t){return this.metadata[t]=this.stream.readString(this.len,"utf8")},d("©alb","album",m),d("©arg","arranger",m),d("©art","artist",m),d("©ART","artist",m),d("aART","albumArtist",m),d("catg","category",m),d("©com","composer",m),d("©cpy","copyright",m),d("cprt","copyright",m),d("©cmt","comments",m),d("©day","releaseDate",m),d("desc","description",m),d("©gen","genre",m),d("©grp","grouping",m),d("©isr","ISRC",m),d("keyw","keywords",m),d("©lab","recordLabel",m),d("ldes","longDescription",m),d("©lyr","lyrics",m),d("©nam","title",m),d("©phg","recordingCopyright",m),d("©prd","producer",m),d("©prf","performers",m),d("purd","purchaseDate",m),d("purl","podcastURL",m),d("©swf","songwriter",m),d("©too","encoder",m),d("©wrt","composer",m),d("covr","coverArt",function(t){return this.metadata[t]=this.stream.readBuffer(this.len)}),p=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"],d("gnre","genre",function(t){return this.metadata[t]=p[this.stream.readUInt16()-1]}),d("tmpo","tempo",function(t){return this.metadata[t]=this.stream.readUInt16()}),d("rtng","rating",function(t){var e;return e=this.stream.readUInt8(),this.metadata[t]=2===e?"Clean":0!==e?"Explicit":"None"}),l=function(t){return this.stream.advance(2),this.metadata[t]=this.stream.readUInt16()+" of "+this.stream.readUInt16(),this.stream.advance(this.len-6)},d("disk","diskNumber",l),d("trkn","trackNumber",l),f=function(t){return this.metadata[t]=1===this.stream.readUInt8()},d("cpil","compilation",f),d("pcst","podcast",f),d("pgap","gapless",f),e}(r.Demuxer);var f,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};f=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),r.Demuxer.register(e),e.probe=function(t){var e;return"FORM"===t.peekString(0,4)&&("AIFF"===(e=t.peekString(8,4))||"AIFC"===e)},e.prototype.readChunk=function(){var t,e,r,i;if(!this.readStart&&this.stream.available(12)){if("FORM"!==this.stream.readString(4))return this.emit("error","Invalid AIFF.");if(this.fileSize=this.stream.readUInt32(),this.fileType=this.stream.readString(4),this.readStart=!0,"AIFF"!==(i=this.fileType)&&"AIFC"!==i)return this.emit("error","Invalid AIFF.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32()),this.type){case"COMM":if(!this.stream.available(this.len))return;this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:!1,floatingPoint:!1},this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,"AIFC"===this.fileType&&(e=this.stream.readString(4),this.format.littleEndian="sowt"===e&&this.format.bitsPerChannel>8,this.format.floatingPoint="fl32"===e||"fl64"===e,("twos"===e||"sowt"===e||"fl32"===e||"fl64"===e||"NONE"===e)&&(e="lpcm"),this.format.formatID=e,this.len-=4),this.stream.advance(this.len-18),this.emit("format",this.format),this.emit("duration",this.format.sampleCount/this.format.sampleRate*1e3|0);break;case"SSND":this.readSSNDHeader&&this.stream.available(4)||(r=this.stream.readUInt32(),this.stream.advance(4),this.stream.advance(r),this.readSSNDHeader=!0),t=this.stream.readSingleBuffer(this.len),this.len-=t.length,this.readHeaders=this.len>0,this.emit("data",t);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"SSND"!==this.type&&(this.readHeaders=!1)}},e}(r.Demuxer);var c,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var i;return s(e,t),r.Demuxer.register(e),e.probe=function(t){return"RIFF"===t.peekString(0,4)&&"WAVE"===t.peekString(8,4)},i={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"},e.prototype.readChunk=function(){var t,e,r;if(!this.readStart&&this.stream.available(12)){if("RIFF"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.");if(this.fileSize=this.stream.readUInt32(!0),this.readStart=!0,"WAVE"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32(!0)),this.type){case"fmt ":if(r=this.stream.readUInt16(!0),!(r in i))return this.emit("error","Unsupported format in WAV file.");this.format={formatID:i[r],floatingPoint:3===r,littleEndian:"lpcm"===i[r],channelsPerFrame:this.stream.readUInt16(!0),sampleRate:this.stream.readUInt32(!0),framesPerPacket:1},this.stream.advance(4),this.stream.advance(2),this.format.bitsPerChannel=this.stream.readUInt16(!0),this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,this.emit("format",this.format),this.stream.advance(this.len-16);break;case"data":this.sentDuration||(e=this.format.bitsPerChannel/8,this.emit("duration",this.len/e/this.format.channelsPerFrame/this.format.sampleRate*1e3|0),this.sentDuration=!0),t=this.stream.readSingleBuffer(this.len),this.len-=t.length,this.readHeaders=this.len>0,this.emit("data",t);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"data"!==this.type&&(this.readHeaders=!1)}},e}(r.Demuxer);var l,i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var i,n;return s(e,t),r.Demuxer.register(e),e.probe=function(t){return".snd"===t.peekString(0,4)},i=[8,8,16,24,32,32,64],i[26]=8,n={1:"ulaw",27:"alaw"},e.prototype.readChunk=function(){var t,e,r,s;if(!this.readHeader&&this.stream.available(24)){if(".snd"!==this.stream.readString(4))return this.emit("error","Invalid AU file.");if(s=this.stream.readUInt32(),e=this.stream.readUInt32(),r=this.stream.readUInt32(),this.format={formatID:n[r]||"lpcm",littleEndian:!1,floatingPoint:6===r||7===r,bitsPerChannel:i[r-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1},null==this.format.bitsPerChannel)return this.emit("error","Unsupported encoding in AU file.");this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,4294967295!==e&&(t=this.format.bitsPerChannel/8,this.emit("duration",e/t/this.format.channelsPerFrame/this.format.sampleRate*1e3|0)),this.emit("format",this.format),this.readHeader=!0}if(this.readHeader)for(;this.stream.available(1);)this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))},e}(r.Demuxer);var p,o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};p=function(t){function e(){return this.readChunk=o(this.readChunk,this),e.__super__.constructor.apply(this,arguments)}return s(e,t),r.Decoder.register("lpcm",e),e.prototype.readChunk=function(){var t,e,r,i,s,n,a,o,h,u,f,c;if(n=this.stream,r=this.format.littleEndian,t=Math.min(4096,n.remainingBytes()),s=t/(this.format.bitsPerChannel/8)|0,t<this.format.bitsPerChannel/8)return null;if(this.format.floatingPoint)switch(this.format.bitsPerChannel){case 32:for(i=new Float32Array(s),e=a=0;s>a;e=a+=1)i[e]=n.readFloat32(r);break;case 64:for(i=new Float64Array(s),e=o=0;s>o;e=o+=1)i[e]=n.readFloat64(r);break;default:throw new Error("Unsupported bit depth.")}else switch(this.format.bitsPerChannel){case 8:for(i=new Int8Array(s),e=h=0;s>h;e=h+=1)i[e]=n.readInt8();break;case 16:for(i=new Int16Array(s),e=u=0;s>u;e=u+=1)i[e]=n.readInt16(r);break;case 24:for(i=new Int32Array(s),e=f=0;s>f;e=f+=1)i[e]=n.readInt24(r);break;case 32:for(i=new Int32Array(s),e=c=0;s>c;e=c+=1)i[e]=n.readInt32(r);break;default:throw new Error("Unsupported bit depth.")}return i},e}(r.Decoder);var d,o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};d=function(t){function e(){return this.readChunk=o(this.readChunk,this),e.__super__.constructor.apply(this,arguments)}var i,n,a,h,u;return s(e,t),r.Decoder.register("ulaw",e),r.Decoder.register("alaw",e),u=128,n=15,h=4,a=112,i=132,e.prototype.init=function(){var t,e,r,s,o,f,c;if(this.format.bitsPerChannel=16,this.table=s=new Int16Array(256),"ulaw"===this.format.formatID)for(t=f=0;256>f;t=++f)o=~t,r=((o&n)<<3)+i,r<<=(o&a)>>>h,s[t]=o&u?i-r:r-i;else for(t=c=0;256>c;t=++c)o=85^t,r=o&n,e=(o&a)>>>h,r=e?r+r+1+32<<e+2:r+r+1<<3,s[t]=o&u?r:-r},e.prototype.readChunk=function(){var t,e,r,i,s,n;if(i=this.stream,s=this.table,r=Math.min(4096,this.stream.remainingBytes()),0!==r){for(e=new Int16Array(r),t=n=0;r>n;t=n+=1)e[t]=s[i.readUInt8()];return e}},e}(r.Decoder);var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.HTTPSource=function(t){function e(t){this.url=t,this.chunkSize=1<<20,this.inflight=!1,this.reset()}return s(e,t),e.prototype.start=function(){return this.length&&!this.inflight?this.loop():(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(t){return function(){return t.length=parseInt(t.xhr.getResponseHeader("Content-Length")),t.inflight=!1,t.loop()}}(this),this.xhr.onerror=function(t){return function(e){return t.pause(),t.emit("error",e)}}(this),this.xhr.onabort=function(t){return function(){return t.inflight=!1}}(this),this.xhr.open("HEAD",this.url,!0),this.xhr.send(null))},e.prototype.loop=function(){var t;return this.inflight||!this.length?this.emit("error","Something is wrong in HTTPSource.loop"):(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(t){return function(){var e,i,s,n,a,o;if(t.xhr.response)e=new Uint8Array(t.xhr.response);else for(n=t.xhr.responseText,e=new Uint8Array(n.length),s=a=0,o=n.length;o>=0?o>a:a>o;s=o>=0?++a:--a)e[s]=255&n.charCodeAt(s);return i=new r.Buffer(e),t.offset+=i.length,t.emit("data",i),t.offset>=t.length&&t.emit("end"),t.inflight=!1,t.offset>=t.length?void 0:t.loop()}}(this),this.xhr.onprogress=function(t){return function(e){return t.emit("progress",(t.offset+e.loaded)/t.length*100)}}(this),this.xhr.onerror=function(t){return function(e){return t.emit("error",e),t.pause()}}(this),this.xhr.onabort=function(t){return function(){return t.inflight=!1}}(this),this.xhr.open("GET",this.url,!0),this.xhr.responseType="arraybuffer",t=Math.min(this.offset+this.chunkSize,this.length),this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+t),this.xhr.overrideMimeType("text/plain; charset=x-user-defined"),this.xhr.send(null))},e.prototype.pause=function(){var t;return this.inflight=!1,null!=(t=this.xhr)?t.abort():void 0},e.prototype.reset=function(){return this.pause(),this.offset=0},e}(r.EventEmitter);var i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};r.FileSource=function(t){function e(t){return this.file=t,"undefined"==typeof FileReader||null===FileReader?this.emit("error","This browser does not have FileReader support."):(this.offset=0,this.length=this.file.size,this.chunkSize=1<<20,void(this.file[this.slice="slice"]||this.file[this.slice="webkitSlice"]||this.file[this.slice="mozSlice"]))}return s(e,t),e.prototype.start=function(){return this.reader&&!this.active?this.loop():(this.reader=new FileReader,this.active=!0,this.reader.onload=function(t){return function(e){var i;return i=new r.Buffer(new Uint8Array(e.target.result)),t.offset+=i.length,t.emit("data",i),t.active=!1,t.offset<t.length?t.loop():void 0}}(this),this.reader.onloadend=function(t){return function(){return t.offset===t.length?(t.emit("end"),t.reader=null):void 0}}(this),this.reader.onerror=function(t){return function(e){return t.emit("error",e)}}(this),this.reader.onprogress=function(t){return function(e){return t.emit("progress",(t.offset+e.loaded)/t.length*100)}}(this),this.loop())},e.prototype.loop=function(){var t,e;return this.active=!0,e=Math.min(this.offset+this.chunkSize,this.length),t=this.file[this.slice](this.offset,e),this.reader.readAsArrayBuffer(t)},e.prototype.pause=function(){var t;this.active=!1;try{return null!=(t=this.reader)?t.abort():void 0}catch(e){}},e.prototype.reset=function(){return this.pause(),this.offset=0},e}(r.EventEmitter),t.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers())},t.prototype.compileLinearInterpolationFunction=function(){for(var t="var bufferLength = buffer.length;  var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {      var ratioWeight = this.ratioWeight;      var weight = this.lastWeight;      var firstWeight = 0;      var secondWeight = 0;      var sourceOffset = 0;      var outputOffset = 0;      var outputBuffer = this.outputBuffer;      for (; weight < 1; weight += ratioWeight) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (this.lastOutput["+e+"] * firstWeight) + (buffer["+e+"] * secondWeight);";t+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(e>0?" + "+e:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+e)+"] * secondWeight);";t+="weight += ratioWeight;        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = buffer[sourceOffset++];";t+='this.lastWeight = weight % 1;      return this.bufferSlice(outputOffset);    }    else {      return (this.noReturn) ? 0 : [];    }  }  else {    throw(new Error("Buffer was of incorrect sample length."));  }',this.resampler=Function("buffer",t)},t.prototype.compileMultiTapFunction=function(){for(var t="var bufferLength = buffer.length;  var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {      var ratioWeight = this.ratioWeight;      var weight = 0;",e=0;e<this.channels;++e)t+="var output"+e+" = 0;";for(t+="var actualPosition = 0;      var amountToNext = 0;      var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;      var outputOffset = 0;      var currentPosition = 0;      do {        if (alreadyProcessedTail) {          weight = ratioWeight;",e=0;e<this.channels;++e)t+="output"+e+" = 0;";for(t+="}        else {          weight = this.lastWeight;",e=0;e<this.channels;++e)t+="output"+e+" = this.lastOutput["+e+"];";for(t+="alreadyProcessedTail = true;        }        while (weight > 0 && actualPosition < bufferLength) {          amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition++] * amountToNext;";for(t+="currentPosition = actualPosition;            weight -= amountToNext;          }          else {",e=0;e<this.channels;++e)t+="output"+e+" += buffer[actualPosition"+(e>0?" + "+e:"")+"] * weight;";for(t+="currentPosition += weight;            weight = 0;            break;          }        }        if (weight == 0) {",e=0;e<this.channels;++e)t+="outputBuffer[outputOffset++] = output"+e+" / ratioWeight;";for(t+="}        else {          this.lastWeight = weight;",e=0;e<this.channels;++e)t+="this.lastOutput["+e+"] = output"+e+";";t+='this.tailExists = true;          break;        }      } while (actualPosition < bufferLength && outputOffset < outLength);      return this.bufferSlice(outputOffset);    }    else {      return (this.noReturn) ? 0 : [];    }  }  else {    throw(new Error("Buffer was of incorrect sample length."));  }',this.resampler=Function("buffer",t)},t.prototype.bypassResampler=function(t){return this.noReturn?(this.outputBuffer=t,t.length):t},t.prototype.bufferSlice=function(t){if(this.noReturn)return t;try{return this.outputBuffer.subarray(0,t)}catch(e){try{return this.outputBuffer.length=t,this.outputBuffer}catch(e){return this.outputBuffer.slice(0,t)}}},t.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(t){this.outputBuffer=[],this.lastOutput=[]}};var m,o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};m=function(i){function n(e,r){this.sampleRate=e,this.channels=r,this.refill=o(this.refill,this),this.context=null!=u?u:u=new a,this.deviceSampleRate=this.context.sampleRate,this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels),this.bufferSize+=this.bufferSize%this.channels,this.deviceSampleRate!==this.sampleRate&&(this.resampler=new t(this.sampleRate,this.deviceSampleRate,this.channels,4096*this.channels)),this.node=this.context[h](4096,this.channels,this.channels),this.node.onaudioprocess=this.refill,this.node.connect(this.context.destination)}var a,h,u;return s(n,i),r.AudioDevice.register(n),a=e.AudioContext||e.webkitAudioContext,n.supported=a&&("function"==typeof a.prototype[h="createScriptProcessor"]||"function"==typeof a.prototype[h="createJavaScriptNode"]),u=null,n.prototype.refill=function(t){var e,r,i,s,n,a,o,h,u,f;for(a=t.outputBuffer,e=a.numberOfChannels,r=new Array(e),s=o=0;e>o;s=o+=1)r[s]=a.getChannelData(s);for(i=new Float32Array(this.bufferSize),this.emit("refill",i),this.resampler&&(i=this.resampler.resampler(i)),s=h=0,f=a.length;f>h;s=h+=1)for(n=u=0;e>u;n=u+=1)r[n][s]=i[s*e+n]},n.prototype.destroy=function(){return this.node.disconnect(0)},n.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate},n}(r.EventEmitter);var v,o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function r(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};return v=function(t){function e(t,e){this.sampleRate=t,this.channels=e,this.refill=o(this.refill,this),this.audio=new Audio,this.audio.mozSetup(this.channels,this.sampleRate),this.writePosition=0,this.prebufferSize=this.sampleRate/2,this.tail=null,this.timer=i(this.refill,100)}var i,n;return s(e,t),r.AudioDevice.register(e),e.supported="undefined"!=typeof Audio&&null!==Audio&&"mozWriteAudio"in new Audio,e.prototype.refill=function(){var t,e,r,i;this.tail&&(i=this.audio.mozWriteAudio(this.tail),this.writePosition+=i,this.tail=this.writePosition<this.tail.length?this.tail.subarray(i):null),r=this.audio.mozCurrentSampleOffset(),t=r+this.prebufferSize-this.writePosition,t>0&&(e=new Float32Array(t),this.emit("refill",e),i=this.audio.mozWriteAudio(e),i<e.length&&(this.tail=e.subarray(i)),this.writePosition+=i)},e.prototype.destroy=function(){return n(this.timer)},e.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels},i=function(t,e){var i,s;return i=r.Buffer.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+e+");"),null==i?setInterval(t,e):(s=new Worker(i),s.onmessage=t,s.url=i,s)},n=function(t){return t.terminate?(t.terminate(),URL.revokeObjectURL(t.url)):clearInterval(t)},e}(r.EventEmitter),e.AV=r}();