!function(t){function n(t){return t.config.thickness||t.config.radius}function e(t){var n=s(t),e=c(t);t.svg=d3.select(t.config.bindTo).append("svg").attr("class",t.config.classNames).attr("width",n).attr("height",e).append("g").attr("transform","translate("+n/2+","+e/2+")"),t.config.background&&t.svg.append("path").attr("class","donut-background").attr("fill","#626262").transition().duration(500).attrTween("d",function(n,e){var i={value:0,startAngle:l(t.config.startAngle),endAngle:l(t.config.endAngle)};return r.call(this,i,e,t)})}function i(t){var n=t.svg.selectAll("path.donut-section").data(t.data),e=d3.tip().attr("class","d3-tip").html(function(t){return Math.round(t.data,2)+"%"});n.enter().append("path").attr("class",function(t,n){return"donut-section value-"+n}).attr("fill",function(n,e){return"function"==typeof t.config.colors?t.config.colors(e):t.config.colors[e]}).attr("stroke","#fff").attr("stroke-width",t.config.offset/2).attr("data-legend",function(n,e){return t.legend[e]}).on("mouseover",e.show).on("mouseout",e.hide),t.svg.selectAll("path.donut-section").transition().duration(500).attrTween("d",function(n,e){return r.call(this,n,e,t)}),n.exit().transition().duration(100).attrTween("d",function(n,e){return a.call(this,n,e,t)}).remove(),n.call(e),t.svg.append("g").attr("class","disk-legend").attr("fill","none").attr("transform","translate(-20, -30)").style("font-size","12px").call(d3.legend)}function r(t,n,e){var i,r,a,o;return this._current||(i=e.svg.selectAll("path")[0][n-1],r=i&&i._current?i._current.endAngle:l(e.config.startAngle),a={startAngle:r,endAngle:r,value:0}),o=d3.interpolate(this._current||a,t),this._current=o(0),function(t){return e.arc(o(t))}}function a(t,n,e){var i={startAngle:l(e.config.endAngle),endAngle:l(e.config.endAngle),value:0},n=d3.interpolate(t,i);return function(t){return e.arc(n(t))}}function o(t){var n=s(t)-t.config.margin.left-t.config.margin.right,e=c(t)-t.config.margin.top-t.config.margin.bottom;return Math.min(n,e)/2}function s(t){return t.config.size&&t.config.size.width}function c(t){return t.config.size&&t.config.size.height}function l(t){return t*(Math.PI/180)}function u(){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(arguments[0][n]=arguments[t][n]);return arguments[0]}var g={bindTo:"body",className:"donut",size:{width:200,height:200},margin:{top:20,right:20,bottom:20,left:20},startAngle:0,endAngle:360,thickness:null,offset:0,sort:null,maxValue:null,background:!1,colors:d3.scale.category20c(),accessor:function(t){return t}},f=t.Donut=function(t){this.config=u({},g,t),this.config.radius=o(this),this.accessor=this.config.accessor,this.pie=d3.layout.pie().sort(this.config.sort).startAngle(l(this.config.startAngle)).endAngle(l(this.config.endAngle)),this.accessor&&"function"==typeof this.accessor&&this.pie.value(this.accessor);var i=n(this);this.arc=d3.svg.arc().innerRadius(this.config.radius-i-this.config.offset/4).outerRadius(this.config.radius+this.config.offset/4),e(this)};f.prototype.load=function(t){var n=t&&null!=t.data?t.data:this.data.map(this.accessor);this.legend=t.legend,n=Array.isArray(n)?n:[n],this.data=this.config.maxValue?this.pieMaxValue(n):this.pie(n),i(this)},f.prototype.pieMaxValue=function(t){var n=this.accessor,e=this,i=t.map(function(t,i){return+n.call(e,t,i)}),r=d3.sum(i),a=d3.max([this.config.maxValue,r]),o=a-r,s=+l(this.config.startAngle),c=(l(this.config.endAngle)-s)/(r+o),u=d3.range(t.length),g=[];return u.forEach(function(n){var e;g[n]={data:t[n],value:e=i[n],startAngle:s,endAngle:s+=e*c}}),g}}(window);
!function(){d3.legend=function(t){return t.each(function(){var t=d3.select(this),e={},n=d3.select(t.property("nearestViewportElement")),l=t.attr("data-style-padding")||5,a=t.selectAll(".legend-box").data([!0]),r=t.selectAll(".legend-items").data([!0]);a.enter().append("rect").classed("legend-box",!0),r.enter().append("g").classed("legend-items",!0),n.selectAll("[data-legend]").each(function(){var t=d3.select(this);e[t.attr("data-legend")]={pos:t.attr("data-legend-pos")||this.getBBox().y,color:void 0!=t.attr("data-legend-color")?t.attr("data-legend-color"):t.style("none"!=t.style("fill")?"fill":"stroke")}}),e=d3.entries(e).sort(function(t,e){return t.value.pos-e.value.pos}),r.selectAll("text").data(e,function(t){return t.key}).call(function(t){t.enter().append("text")}).call(function(t){t.exit().remove()}).attr("fill","#000000").attr("y",function(t,e){return e+"em"}).attr("x","1em").text(function(t){return t.key}),r.selectAll("circle").data(e,function(t){return t.key}).call(function(t){t.enter().append("circle")}).call(function(t){t.exit().remove()}).attr("cy",function(t,e){return e-.25+"em"}).attr("cx",0).attr("r","0.4em").style("fill",function(t){return t.value.color});var c=r[0][0].getBBox();a.attr("x",c.x-l).attr("y",c.y-l).attr("height",c.height+2*l).attr("width",c.width+2*l)}),t}}();