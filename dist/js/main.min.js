function AdminResolver(){return{users:function($http,$q){var defer=$q.defer();return $http.get("admin/users").success(function(data){defer.resolve(data)}),defer.promise},paths:function($http,$q){var defer=$q.defer();return $http.get("admin/paths").success(function(data){defer.resolve(data)}),defer.promise}}}function AlbumResolver($stateParams,$http,$q,$colorThief){var defer=$q.defer();return $http.get("albums/"+$stateParams.albumId).success(function(data){if(data.songs.sort(function(a,b){return a.specific&&a.specific.track&&a.specific.track.no&&b.specific&&b.specific.track&&b.specific.track.no?a.specific.track.no-b.specific.track.no:a.name>b.name}),data.picture){var a=document.createElement("a");a.href=data.picture,a.origin==location.origin&&-1!==location.origin.indexOf("localhost")?defer.resolve(data):$colorThief(data.picture).then(function(colors){data.color=colors[0],defer.resolve(data)})}else defer.resolve(data)}),defer.promise}function MovieResolver($stateParams,$http,$q,$colorThief){var defer=$q.defer();return $http.get("movies/"+$stateParams.movieId).success(function(data){if(data.videos.sort(function(a,b){return a.specific&&b.specific&&a.specific.episode&&b.specific.episode?parseInt(a.specific.episode)-parseInt(b.specific.episode):a.name>b.name}),data.infos&&data.infos.seasonInfos)for(var i in data.videos){var e=data.videos[i];if(e.specific){var episode=data.infos.seasonInfos.episodes[parseInt(e.specific.episode)-1];episode&&(data.videos[i].name=episode.name||e.name,data.videos[i].picture=episode.still_path||null,data.videos[i].synopsis=episode.overview||null,data.videos[i].air_date=episode.air_date||null)}}data.infos.picture?$colorThief(data.infos.backdrop||data.infos.picture).then(function(colors){data.color=colors[0],defer.resolve(data)}):(data.infos.backdrop||(data.infos.backdrop="img/movie/no_backdrop.png"),defer.resolve(data))}),defer.promise}angular.module("ezseed",["mm.foundation","ngRoute","ngStorage","ngAnimate","ui.router","pascalprecht.translate","checklist-model","ngSanitize","btford.socket-io"]).config(["$locationProvider","$logProvider","$urlRouterProvider","$stateProvider","$translateProvider","$httpProvider",function($locationProvider,$logProvider,$urlRouterProvider,$stateProvider,$translateProvider,$httpProvider){$logProvider.debugEnabled(!0),$httpProvider.interceptors.push("httpInterceptor"),$translateProvider.useMissingTranslationHandlerLog(),$translateProvider.useUrlLoader("locales.json"),$translateProvider.preferredLanguage("en_US"),moment.locale("en"),$urlRouterProvider.otherwise("/login"),$stateProvider.state("login",{url:"/login",templateUrl:"partials/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout",controller:function($localStorage,$state){delete $localStorage.user,$state.transitionTo("login",{},{reload:!0,inherit:!1,notify:!0})}}).state("admin",{url:"/admin",views:{"":{templateUrl:"partials/admin.html",controller:"adminCtrl"},"nav@admin":{templateUrl:"partials/header.html",controller:"NavCtrl"}},resolve:AdminResolver()}).state("settings",{url:"/settings",views:{"":{templateUrl:"partials/settings.html",controller:"settingsCtrl"},"nav@settings":{templateUrl:"partials/header.html",controller:"NavCtrl"}}}).state("home",{"abstract":!0,views:{"":{templateUrl:"partials/container.html"},"sidebar@home":{templateUrl:"partials/sidebar.html",controller:"sidebarCtrl",resolve:{paths:function($http,$q,$localStorage){var defer=$q.defer();return $http.get("api/-").success(function(data){angular.extend($localStorage.user,data),defer.resolve(data)}),defer.promise},size:function($http,$q){var defer=$q.defer();return $http.get("api/-/size").success(function(data){defer.resolve(data)}),defer.promise}}},"nav@home":{templateUrl:"partials/header.html",controller:"NavCtrl"}}}).state("home.desktop",{url:"/",views:{desktop:{templateUrl:"partials/desktop.html",controller:"DesktopCtrl",resolve:{recent:function($http,$q){var defer=$q.defer();return $http.get("api/-/files",{params:{limit:14,sort:"-dateAdded"}}).success(function(data){defer.resolve(data)}),defer.promise}}}}}).state("home.type",{url:"/:type",views:{desktop:{templateUrl:"partials/desktop.html",controller:"DesktopCtrl",resolve:{recent:function($recent,$stateParams){return $recent($stateParams.type)}}}}}).state("items",{"abstract":!0,views:{"":{templateUrl:"partials/items/container.html"},"nav@items":{templateUrl:"partials/header.html",controller:"NavCtrl"}}}).state("items.movie",{url:"/movie/:movieId",views:{"":{templateUrl:"partials/items/movie.html",controller:"MovieCtrl",resolve:{movie:MovieResolver}}}}).state("items.album",{url:"/album/:albumId",views:{"":{templateUrl:"partials/items/album.html",controller:"AlbumCtrl",resolve:{album:AlbumResolver}}}}),$locationProvider.html5Mode(!1).hashPrefix("!")}]).run(["$http","$localStorage","$rootScope","$stateParams","$translate",function($http,$localStorage,$rootScope,$stateParams,$translate){$localStorage.user&&($http.defaults.headers.common.Authorization="Bearer "+$localStorage.user.token,$translate.use($localStorage.user.lang)),$rootScope.$stateParams=$stateParams,$rootScope.search={params:{},query:{}}}]),angular.module("ezseed").filter("capitalize",function(){return function(input){return input&&(input=input.toLowerCase().charAt(0).toUpperCase()+input.substring(1)),input}}).filter("prettyDate",function(){return function(date){return moment(date).format("llll")}}).filter("count",function(){return function(o){return angular.isArray(o)?o.length:"object"==typeof o?Object.keys(o).length:0}}).filter("prettyBytes",function(){var isNaN=function(val){return val!==val},prettyBytes=function(num){if(num=parseInt(num),"number"!=typeof num||isNaN(num))throw new TypeError("Expected a number");var exponent,unit,neg=0>num,units=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return neg&&(num=-num),0===num?"0 B":(exponent=Math.min(Math.floor(Math.log(num)/Math.log(1e3)),units.length-1),num=1*(num/Math.pow(1e3,exponent)).toFixed(2),unit=units[exponent],(neg?"-":"")+num+" "+unit)};return prettyBytes}),angular.module("ezseed").controller("adminCtrl",["$scope","users","paths","$log","$http","$state","$stateParams",function($scope,users,paths,$log,$http,$state,$stateParams){$log.debug("Admin users",users),$log.debug("Admin paths",paths),$scope.users=users,$scope.paths=paths;var hasPath=function(user,path){for(var i in user.paths)if(path._id==user.paths[i]._id)return!0;return!1};$scope.isWatching=function(user,path){return user.default_path==path._id?"&#9733;":hasPath(user,path)?"&#10003;":"&#10007;"},$scope.watch=function(user,path){if(user.default_path==path._id)return!1;var next=function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})};hasPath(user,path)?$http.delete("admin/user/"+user._id+"/path/"+path._id).success(next):user.default_path!==path._id&&$http.put("admin/user/"+user._id+"/path/"+path._id).success(next)},$scope.deletePath=function(id_path){$http.delete("admin/path/"+id_path).success(function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})})},$scope.isValidPath=function(e,path){e.currentTarget.value&&$http.get("admin/validPath",{params:{path:e.currentTarget.value}}).success(function(data){path?path.error=data.error:$scope.path.error=data.error})},$scope.new=!1,$scope.edit=[],$scope.togglePath=function(){$scope.new=!$scope.new},$scope.editPath=function($index,path){$scope.edit[$index]=angular.copy(path)},$scope.cancelPath=function($index){$scope.paths[$index]=$scope.edit[$index],$scope.edit[$index]=!1},$scope.getPath=function(default_path){for(var i in $scope.paths)if($scope.paths[i]._id==default_path)return $scope.paths[i].path}}]).controller("adminNewPathCtrl",["$scope","$http","$state","$stateParams",function($scope,$http,$state,$stateParams){$scope.path={},$scope.createPath=function(){$http.post("admin/path",{path:$scope.path.path}).success(function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})})}}]).controller("adminUpdatePathCtrl",["$scope","$http","$loaderService",function($scope,$http,$loaderService){$scope.updatePath=function($index,path){$http.put("admin/path/"+path._id,{path:path.path}).success(function(){$loaderService.alert("Path saved!","success"),$scope.edit[$index]=!1})}}]).controller("adminUserCtrl",["$scope","$http","$loaderService",function($scope,$http,$loaderService){$scope.editing=[],$scope.edit=function($index,user){$scope.editing[$index]=angular.copy(user)},$scope.cancel=function($index){$scope.users[$index]=$scope.editing[$index],$scope.editing[$index]=!1},$scope.save=function($index,user){$http.put("admin/user/"+user._id,{default_path:user.default_path,spaceLeft:user.spaceLeft,role:user.role}).success(function(){$loaderService.alert("User saved!","success"),$scope.editing[$index]=!1})}}]),angular.module("ezseed").factory("$socket",["socketFactory",function(socketFactory){return socketFactory({prefix:""})}]).controller("DesktopCtrl",["$scope","$stateParams","$rootScope","recent","$recent","$loaderService","$socket",function($scope,$stateParams,$rootScope,recent,$recent,$loaderService,$socket){$rootScope.recent=recent,$socket.on("update",function(){$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data})}),$socket.on("watching",$loaderService.load)}]),angular.module("ezseed").controller("LoginCtrl",["$scope","$http","$localStorage","$log","$state","$loaderService","$rootScope",function($scope,$http,$localStorage,$log,$state,$loaderService,$rootScope){if($localStorage.user)return $state.transitionTo("home.desktop");var body=document.querySelector("body");body.classList.add("login"),document.querySelector('input[type="text"]').focus(),$scope.userf={},$scope.login=function(){$http.post("api/login",$scope.userf).success(function(user){user.error?$loaderService.alert(user.error):($log.debug("User logged in",user),body.classList.remove("login"),$localStorage.user=user,$rootScope.user=$localStorage.user,$http.defaults.headers.common.Authorization="Bearer "+$localStorage.user.token,$state.transitionTo("home.desktop",{},{reload:!0,inherit:!1,notify:!0}))})}}]),angular.module("ezseed").controller("MainCtrl",["$scope","$location","$localStorage",function($scope,$location,$localStorage){$scope.user=$localStorage.user,$scope.user||"/login"===$location.path()||$location.path("/login"),$scope.sidebar=!0,$scope.toggleSidebar=function(){$scope.sidebar=!$scope.sidebar},$scope.filters={videos:!1,albums:!1,others:!1},$scope.displays={list:!0,table:!1,thumb:!1},$scope.tags={sd:!1,hd:!1,movie:!1,serie:!1}}]),angular.module("ezseed").controller("NavCtrl",["$scope","$http","$localStorage","$rootScope","$recent","$timeout","$stateParams",function($scope,$http,$localStorage,$rootScope,$recent,$timeout,$stateParams){$scope.resetLibrairy=function($event){$event.preventDefault(),$http.get("api/-/reset").success(function(){$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data})})},$scope.refreshLibrairy=function($event){$event.preventDefault(),$http.get("api/-/refresh").success(function(){$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data})})};var timeout;$scope.search=function(){timeout?clearTimeout(timeout):timeout,timeout=setTimeout(function(){var search=document.getElementById("search").value;search.replace(" ","").length?($rootScope.search.params.search=search,$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data})):($rootScope.search.params.search=null,$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data}))},375)},Mousetrap.bind("/",function(e){e.preventDefault(),document.getElementById("search").focus()})}]),angular.module("ezseed").controller("settingsCtrl",["$scope","$localStorage","$translate",function($scope,$localStorage,$translate){$scope.lang=$localStorage.user.lang?$localStorage.user.lang:"en_US",$scope.changeLanguage=function(){$localStorage.user.lang=$scope.lang,$translate.use($scope.lang)}}]),angular.module("ezseed").controller("sidebarCtrl",["$scope","$http","paths","size","$log","$rootScope","$recent","$stateParams","$translate",function($scope,$http,paths,size,$log,$rootScope,$recent,$stateParams){$scope.paths=paths,$log.debug("paths: ",paths),$scope.size=size,$log.debug("size: ",size),$scope.usageDetails={size:size.total.pretty,total:$scope.user.prettySize},$scope.array_colors=["#A7C5BD","#EB7B59","#CF4647"],$scope.array_sizes=[size.albums.percent,size.movies.percent,size.others.percent],$scope.watched_paths=[],$scope.$watchCollection("watched_paths",function(newVal,oldVal){angular.equals(newVal,oldVal)||console.log(newVal)}),$scope.choose=function(){return function(params){for(var i in params)$rootScope.search.params[i]=params[i]==$rootScope.search.params[i]?null:params[i];$rootScope.recent={},$recent($stateParams.type,$rootScope.search.params).then(function(data){$rootScope.recent=data})}}}]),angular.module("ezseed").directive("diskMeter",["$addStylesheetRule",function($addStylesheetRule){var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1];return{restrict:"A",scope:{diskSizes:"=",diskColors:"=?"},link:function(scope,element){for(var colors=scope.diskColors,sizes=scope.diskSizes,gradient="",percent=5,l=2*colors.length,c=0,i=0;l>i;i++)0===i?(gradient+=colors[i]+" 0%, ",percent=0):i==l-1?(c=colors.length-1,gradient+=colors[c]+" 100%);"):i%2!=0?(c=(i-1)/2+1,percent+=0==Math.floor(sizes[c-1])?1:Math.floor(sizes[c-1])-1,gradient+=colors[c-1]+" "+percent+"%, "):(c=i/2,gradient+=colors[c]+" "+percent+"%, ");var sheet=document.head.appendChild(document.createElement("style")).sheet;"webkit"==pre?sheet=$addStylesheetRule(sheet)("meter#"+element[0].id+"::-webkit-meter-optimum-value",{"background-image":"linear-gradient(90deg, "+gradient}):"moz"==pre&&(sheet=$addStylesheetRule(sheet)("meter#"+element[0].id+"::-moz-meter-bar",{"background-image":"linear-gradient(90deg, "+gradient}))}}}]),angular.module("ezseed").directive("dynamicBackground",["$addStylesheetRule",function($addStylesheetRule){var scaleColor=function(c,n,i,d){for(i=3;i--;c[i]=0>d?0:d>255?255:0|d)d=c[i]+n;return c};return{restrict:"E",scope:{color:"=",factor:"@?"},link:function(scope,element){if(!scope.color)return void console.warn("No color to add");if(!angular.isArray(scope.color))throw new Error("We need an rgb array color!");var sheet=document.head.appendChild(document.createElement("style")).sheet,darker=scaleColor(angular.copy(scope.color),scope.factor||-30);sheet=$addStylesheetRule(sheet)(".button.secondary, button.secondary, .label.secondary",{"background-color":"rgb("+scope.color.join(",")+")","border-color":"rgb("+darker.join(",")+")"}),sheet=$addStylesheetRule(sheet)(".button.secondary:hover, button.secondary:hover",{"background-color":"rgb("+darker.join(",")+")"}),sheet=$addStylesheetRule(sheet)("#audio-player .meter",{"background-color":"rgb("+scope.color.join(",")+")"}),sheet=$addStylesheetRule(sheet)("a",{color:"rgb("+scope.color.join(",")+")"}),sheet=$addStylesheetRule(sheet)("a:hover",{color:"rgb("+darker.join(",")+")"}),element[0].style.display="none"}}}]),angular.module("ezseed").directive("ezScroll",["$window",function($window){return{restrict:"A",link:function(scope,element){angular.element($window).bind("scroll",function(){element.css(this.pageYOffset>20?{"padding-top":this.pageYOffset-50+"px"}:{"padding-top":0})})}}}]),angular.module("ezseed").filter("tvShowsPacker",function(){return function(movies){var shows=[];for(var i in movies){var e=movies[i];shows[e.name]||(shows[e.name]=[]),shows[e.name].push(e)}for(var j in shows)shows[j].sort(function(a,b){return parseInt(a.season)-parseInt(b.season)});var blocks=[],maxLength=0;for(var o in shows){var l=shows[o].length;blocks.push({h:l,w:Math.max(2,Math.min(12,2*l)),shows:shows[o],name:o}),maxLength+=10*l}blocks.sort(function(a,b){return b.w-a.w});var pack=new Packer(6,10*shows.length);pack.fit(blocks),blocks.sort(function(a,b){a.fit||(a.fit={x:maxLength,y:0}),b.fit||(b.fit={x:maxLength,y:0});var x=parseInt(a.fit.y+""+a.fit.x),y=parseInt(b.fit.y+""+b.fit.x);return x-y});for(var u in blocks)blocks[u].fit&&(blocks[u].until=0==u?blocks[u].shows.length:blocks[u-1].until+blocks[u].shows.length,blocks[u].num=0==u?0:blocks[u].until-blocks[u].shows.length,blocks[u].style=blocks[u].num%6==0?{clear:"left"}:{});return blocks}}),angular.module("ezseed").factory("AVPlayer",["$loaderService",function($loaderService){var player=null,currentTime=0,oldSeconds=0,remaining=!1,pad=function(input){return("00"+input).slice(-2)};return function(scope){return scope.player={},function(songs,options){scope.player.toggleTimer=function(){remaining=!remaining};var self={};return self.songs=songs,self.max=songs.length,self.id=options.id?options.id:null,angular.extend(self,{current:0,loop:!1,trackLength:0,playing:function(i){return player&&player.playing&&(void 0===i||this.current==i)},disconnect:function(){player.off("end",this.end),player.off("error",this.error),player.off("progress",this.progress),player.off("duration",this.duration)},play:function(){player&&player.playing&&this.stop(),player=AV.Player.fromURL(this.songs[this.current]),player.on("end",this.end),player.on("error",this.error),player.on("progress",this.progress?this.progress:function(){}),player.on("duration",this.duration?this.duration:function(){}),player.play()},playSong:function(i){return this.playing(i)?!1:(this.current=i,this.play())},toggle:function(){return player?player.togglePlayback():this.play()},stop:function(){player&&(player.stop(),this.disconnect())},next:function(force){if(this.current==this.max-1){if(this.loop===!1&&!force)return this.player.stop(),!1;this.current=0}else this.current++;return this.play()},prev:function(force){if(0==this.current){if(this.loop===!1&&!force)return this.player.stop(),!1;this.current=this.max-1}else this.current--;return this.play()},volume:function(v){return console.log(v),player?player.volume=v:!1},trackLength:0,position:0,timeSpent:"+0:00",trackLength:"0:00",progress:function(time){oldSeconds=Math.floor(currentTime/1e3%60),currentTime=time,currentTime>=trackLength&&trackLength>0&&console.log("trackend");var t=currentTime/1e3,seconds=Math.floor(t%60),minutes=Math.floor((t/=60)%60),l=trackLength/1e3,s=Math.floor(l%60),m=Math.floor((l/=60)%60);if(scope.player.trackLength=m+":"+pad(s),seconds!==oldSeconds){if(scope.player.timeSpent="+"+pad(minutes)+":"+pad(seconds),scope.player.position=100*Math.max(0,Math.min(1,currentTime/trackLength)),trackLength>0){var r=(trackLength-currentTime)/1e3,remainingSeconds=Math.floor(r%60),remainingMinutes=Math.floor((r/=60)%60);scope.player.timeRemaining="-"+remainingMinutes+":"+pad(remainingSeconds)}else scope.player.timeRemaining="-0:00";scope.player.time=remaining?scope.player.timeRemaining:scope.player.timeSpent,scope.$digest()}},duration:function(d){trackLength=d},end:function(){return self.next()},error:function(e){console.error(e),$loaderService.alert(e.message,"alert")}})}}}]),angular.module("ezseed").factory("$addStylesheetRule",function(){return function(sheet){return function(selector,css){var propText="string"==typeof css?css:Object.keys(css).map(function(p){return p+":"+("content"===p?"'"+css[p]+"'":css[p])}).join(";");return sheet.insertRule(selector+"{"+propText+"}",sheet.cssRules.length),sheet}}}),angular.module("ezseed").service("$colorThief",["$http","$q",function($http,$q){return function(url){var defer=$q.defer();return $http.get("http://soyuka.me/color-thief/",{params:{image:url}}).success(function(data){defer.resolve(data)}),defer.promise}}]),angular.module("ezseed").factory("httpInterceptor",["$loaderService","$q","$log","$location",function($loaderService,$q,$log,$location){return{request:function(config){return $loaderService.load(!0),config},requestError:function(rejection){return $loaderService.load(!1),$log.debug("request error",rejection),$q.reject(rejection)},response:function(response){return $loaderService.load(!1),response},responseError:function(rejection){return $loaderService.load(!1),$log.debug("response error",rejection),$loaderService.alert(rejection.data.error?rejection.data.error:rejection.statusText),"404"==rejection.status&&$location.path("/"),$q.reject(rejection)}}}]),angular.module("ezseed").service("$loaderService",["$rootScope","$log",function($rootScope,$log){return $rootScope.loading=!1,$rootScope.alert=null,$rootScope.closeAlert=function(){$rootScope.alert=null},{alert:function(error,type){"success"!==type&&$log.error(error),$rootScope.alert&&$rootScope.closeAlert(),$rootScope.alert={message:error,type:type||"alert"},setTimeout(function(){$rootScope.closeAlert(),$rootScope.$apply()},2650)},load:function(loading){loading===!0?this.pending++:this.pending--,$rootScope.loading=this.pending>0?!0:!1},pending:0}}]),angular.module("ezseed").factory("$recent",["$q","$http","$stateParams","$log","$filter","$rootScope",function($q,$http,$stateParams,$log,$filter,$rootScope){return function(type,params){var default_params={sort:"-dateAdded"},defer=$q.defer();return params="object"==typeof type?type:params?params:{},type="object"==typeof type?null:type,$log.debug("Call recent for type %s with params %o",type,params),default_params.type=type?type:$stateParams.type,$http.get("api/-/files",{params:angular.extend(default_params,{match:params})}).success(function(data){$rootScope.search&&$rootScope.search.params&&"tvseries"==$rootScope.search.params.movieType&&(data.movies=$filter("tvShowsPacker")(data.movies)),$log.debug("Recent: ",data),defer.resolve(data)}),defer.promise}}]),Packer=function(w,h){this.init(w,h)},Packer.prototype={init:function(w,h){this.root={x:0,y:0,w:w,h:h}},fit:function(blocks){var n,node,block;for(n=0;n<blocks.length;n++)block=blocks[n],(node=this.findNode(this.root,block.w,block.h))&&(block.fit=this.splitNode(node,block.w,block.h))},findNode:function(root,w,h){return root.used?this.findNode(root.right,w,h)||this.findNode(root.down,w,h):w<=root.w&&h<=root.h?root:null},splitNode:function(node,w,h){return node.used=!0,node.down={x:node.x,y:node.y+h,w:node.w,h:node.h-h},node.right={x:node.x+w,y:node.y,w:node.w-w,h:h},node}},angular.module("ezseed").controller("AlbumCtrl",["$scope","$log","album","$loaderService","AVPlayer","$rootScope",function($scope,$log,album,$loaderService,AVPlayer,$rootScope){$log.debug("Album: ",album),$scope.album=album,$scope.bgColor=album.color?album.color:"";var urls=[];for(var i in album.songs)urls.push("/albums/"+album.songs[i]._id+"/download");var player=AVPlayer($rootScope);$rootScope.player.id?$rootScope.player.id!==album._id&&($rootScope.player.stop(),$rootScope.player=player(urls,{id:album._id})):$rootScope.player=player(urls,{id:album._id}),console.log($scope.player),Mousetrap.bind("space",function(){$rootScope.player&&($rootScope.player.toggle(),$rootScope.$digest())})}]),angular.module("ezseed").controller("MovieCtrl",["$scope","$log","movie",function($scope,$log,movie){$log.debug("Movie: ",movie),$scope.movie=movie,$scope.movieStyle="'background-image'= '"+movie.infos.backdrop+"'",$scope.bgColor=movie.color,$scope.selectVideoLink=function(){document.getElementById("video_link").select()},$scope.video=!1;var player=document.getElementById("video_container");$scope.play=function(video){video.download="/movies/"+video._id+"/download",video.direct_link=window.location.origin+video.download,$scope.video=video,player.innerHTML="<video><source type='video/mp4' src='/movies/"+video._id+"/stream'/></video><br><embed id='VLC' type='application/x-vlc-plugin' pluginspage='http://www.videolan.org' width='720px' height='480px' style='display: inline-block;' autoplay='yes' target='"+video.download+"'></embed>"}}]).controller("tvshowController",["$scope","$filter",function($scope,$filter){$scope.countShows=function(tvshow){var num=$filter("count")(tvshow);return $scope.numCols=Math.max(2,Math.min(12,2*num)),$scope.numBlock=Math.min(num,6),$scope.numCols}}]);